<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <PublishReadyToRun>true</PublishReadyToRun>
    <!-- Add rpath to look in the same directory -->
    <RunWorkingDirectory>$(MSBuildProjectDirectory)</RunWorkingDirectory>
  </PropertyGroup>

  <ItemGroup>
    <Reference Include="ThermoFisher.CommonCore.BackgroundSubtraction">
      <HintPath>Libs\NetCore\ThermoFisher.CommonCore.BackgroundSubtraction.dll</HintPath>
      <Private>true</Private>
    </Reference>
    <Reference Include="ThermoFisher.CommonCore.Data">
      <HintPath>Libs\NetCore\ThermoFisher.CommonCore.Data.dll</HintPath>
      <Private>true</Private>
    </Reference>
    <Reference Include="ThermoFisher.CommonCore.MassPrecisionEstimator">
      <HintPath>Libs\NetCore\ThermoFisher.CommonCore.MassPrecisionEstimator.dll</HintPath>
      <Private>true</Private>
    </Reference>
    <Reference Include="ThermoFisher.CommonCore.RawFileReader">
      <HintPath>Libs\NetCore\ThermoFisher.CommonCore.RawFileReader.dll</HintPath>
      <Private>true</Private>
    </Reference>
    <Reference Include="Apache.Arrow">
      <HintPath>Libs\Apache.Arrow.dll</HintPath>
      <Private>true</Private>
    </Reference>
  </ItemGroup>

  <!-- Copy runtime libraries only -->
  <Target Name="CopyAllFiles" BeforeTargets="Build">
    <ItemGroup>
      <!-- Include managed and native libraries but skip docs and packages -->
      <LibFiles Include="Libs\**\*.dll;Libs\**\*.so;Libs\**\*.dylib" />
    </ItemGroup>
    <Copy SourceFiles="@(LibFiles)" DestinationFiles="@(LibFiles->'$(OutputPath)\lib\%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>

  <!-- Also copy for publish -->
  <Target Name="CopyAllFilesOnPublish" BeforeTargets="Publish">
    <ItemGroup>
      <!-- Include managed and native libraries but skip docs and packages -->
      <LibFiles Include="Libs\**\*.dll;Libs\**\*.so;Libs\**\*.dylib" />
    </ItemGroup>
    <Copy SourceFiles="@(LibFiles)" DestinationFiles="@(LibFiles->'$(PublishDir)\lib\%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>

  <!-- Remove documentation and package files from build output -->
  <Target Name="RemoveNonRuntimeFiles" AfterTargets="Build">
    <ItemGroup>
      <UnneededFiles Include="$(OutputPath)\*.xml;$(OutputPath)\*.pdb;$(OutputPath)\*.nupkg" />
    </ItemGroup>
    <Delete Files="@(UnneededFiles)" />
  </Target>

  <!-- Remove documentation and package files from publish output -->
  <Target Name="RemoveNonRuntimeFilesOnPublish" AfterTargets="Publish">
    <ItemGroup>
      <UnneededFiles Include="$(PublishDir)\*.xml;$(PublishDir)\*.pdb;$(PublishDir)\*.nupkg" />
    </ItemGroup>
    <Delete Files="@(UnneededFiles)" />
  </Target>

</Project>
